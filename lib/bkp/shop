
// import 'dart:convert';
// import 'package:flutter/material.dart';
// import 'package:flutter_bloc/flutter_bloc.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_bloc.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_event.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_state.dart';
// import 'package:vesture_firebase_user/screens/product_Details.dart';
// import 'package:vesture_firebase_user/widgets/custom_appbar.dart';
// import 'package:vesture_firebase_user/widgets/custom_search.dart';
// import 'package:vesture_firebase_user/widgets/textwidget.dart';

// class ShoppingPage extends StatelessWidget {
//   const ShoppingPage({super.key});

//   @override
//   Widget build(BuildContext context) {
//     return BlocProvider(
//       create: (context) => ProductBloc()..add(FetchProductsEvent()),
//       child: Scaffold(
//         appBar: buildCustomAppBar(context: context, title: 'Shopping Page'),
//         body: Column(
//           children: [
//             customSearchField(context),
//             BlocBuilder<ProductBloc, ProductState>(
//               builder: (context, state) {
//                 if (state is ProductLoadingState) {
//                   return Expanded(
//                     child: Center(
//                         child: customSpinkitLoaderWithType(
//                       context: context,
//                       type: SpinkitType.fadingCube,
//                       color: Colors.red,
//                       size: 60.0,
//                     )),
//                   );
//                 }

//                 if (state is ProductErrorState) {
//                   return Expanded(
//                     child: Center(
//                       child: Text(
//                         'Error: ${state.errorMessage}',
//                         style: const TextStyle(color: Colors.red),
//                       ),
//                     ),
//                   );
//                 }

//                 if (state is ProductLoadedState) {
//                   return Expanded(
//                     child: GridView.builder(
//                       padding: const EdgeInsets.all(10),
//                       gridDelegate:
//                           const SliverGridDelegateWithFixedCrossAxisCount(
//                         crossAxisCount: 2,
//                         childAspectRatio: 0.65,
//                         crossAxisSpacing: 2,
//                         mainAxisSpacing: 2,
//                       ),
//                       itemCount: state.products.length,
//                       itemBuilder: (context, index) {
//                         final product = state.products[index];
//                         final defaultImages = product.getDefaultImages();
//                         final defaultPrice = product.getDefaultPrice();

//                         return GestureDetector(
//                           onTap: () {
//                             Navigator.push(
//                                 context,
//                                 MaterialPageRoute(
//                                     builder: (context) => ProductDetailsPage(
//                                         productId: product.id!)));
//                           },
//                           child: SizedBox(
//                             child: Card(
//                               shape: RoundedRectangleBorder(
//                                 borderRadius: BorderRadius.circular(1),
//                               ),
//                               elevation: 2,
//                               shadowColor: Colors.red,
//                               child: Column(
//                                 crossAxisAlignment: CrossAxisAlignment.start,
//                                 children: [
//                                   AspectRatio(
//                                     aspectRatio: 1,
//                                     child: defaultImages.isNotEmpty
//                                         ? Image.memory(
//                                             base64Decode(defaultImages.first),
//                                             fit: BoxFit.cover,
//                                             errorBuilder:
//                                                 (context, error, stackTrace) {
//                                               return const Icon(
//                                                   Icons.image_not_supported);
//                                             },
//                                           )
//                                         : const Icon(Icons.image_not_supported),
//                                   ),
//                                   Padding(
//                                     padding: const EdgeInsets.all(8.0),
//                                     child: Column(
//                                       crossAxisAlignment:
//                                           CrossAxisAlignment.start,
//                                       children: [
//                                         const Text(
//                                           '⭐⭐⭐⭐⭐(5)',
//                                           style: TextStyle(fontSize: 10),
//                                         ),
//                                         Text(
//                                           product.productName,
//                                           style: styling(
//                                             fontFamily: 'Poppins-Bold',
//                                             fontSize: 20,
//                                           ),
//                                           maxLines: 1,
//                                           overflow: TextOverflow.ellipsis,
//                                         ),
//                                         const SizedBox(height: 4),
//                                         Text(
//                                           product.brandName ??
//                                               'Unknown Brand', // Updated this line
//                                           style: styling(
//                                             fontFamily: 'Poppins-Regular',
//                                             fontSize: 12,
//                                             color: Colors.grey,
//                                           ),
//                                         ),
//                                         const SizedBox(height: 4),
//                                         Text(
//                                           '\₹${defaultPrice.toStringAsFixed(2)}',
//                                           style: styling(
//                                             fontFamily: 'Poppins-Regular',
//                                             fontSize: 12,
//                                           ),
//                                         ),
//                                       ],
//                                     ),
//                                   ),
//                                 ],
//                               ),
//                             ),
//                           ),
//                         );
//                       },
//                     ),
//                   );
//                 }

//                 return const SizedBox.shrink();
//               },
//             ),
//           ],
//         ),
//       ),
//     );
//   }
// }
   


   // // import 'dart:convert';

// // import 'package:cloud_firestore/cloud_firestore.dart';
// // import 'package:flutter/material.dart';
// // import 'package:flutter_bloc/flutter_bloc.dart';
// // import 'package:vesture_firebase_user/bloc/Product/product_bloc.dart';
// // import 'package:vesture_firebase_user/bloc/Product/product_event.dart';
// // import 'package:vesture_firebase_user/bloc/Product/product_state.dart';
// // import 'package:vesture_firebase_user/widgets/custom_appbar.dart';
// // import 'package:vesture_firebase_user/widgets/custom_search.dart';
// // import 'package:vesture_firebase_user/widgets/textwidget.dart';

// // class ShoppingPage extends StatelessWidget {
// //   const ShoppingPage({super.key});

// //   @override
// //   Widget build(BuildContext context) {
// //     return BlocProvider(
// //       create: (context) => ProductBloc()..add(FetchProductsEvent()),
// //       child: Scaffold(
// //         appBar: buildCustomAppBar(context: context, title: 'ShoppingPage'),
// //         body: Column(
// //           children: [
// //             customSearchField(context),
// //             BlocBuilder<ProductBloc, ProductState>(
// //               builder: (context, state) {
// //                 if (state is ProductLoadingState) {
// //                   return const Center(child: CircularProgressIndicator());
// //                 }

// //                 if (state is ProductErrorState) {
// //                   return Center(
// //                     child: Text(
// //                       'Error: ${state.errorMessage}',
// //                       style: const TextStyle(color: Colors.red),
// //                     ),
// //                   );
// //                 }

// //                 if (state is ProductLoadedState) {
// //                   return Expanded(
// //                     child: GridView.builder(
// //                       padding: const EdgeInsets.all(10),
// //                       gridDelegate:
// //                           const SliverGridDelegateWithFixedCrossAxisCount(
// //                         crossAxisCount: 2,
// //                         childAspectRatio: 0.65,
// //                         crossAxisSpacing: 2,
// //                         mainAxisSpacing: 2,
// //                       ),
// //                       itemCount: state.products.length,
// //                       itemBuilder: (context, index) {
// //                         final product = state.products[index];
// //                         return SizedBox(
// //                           child: Card(
// //                             shape: RoundedRectangleBorder(
// //                               borderRadius: BorderRadius.circular(1),
// //                             ),
// //                             elevation: 2,
// //                             shadowColor: Colors.red,
// //                             child: Column(
// //                               crossAxisAlignment: CrossAxisAlignment.start,
// //                               children: [
// //                                 AspectRatio(
// //                                   aspectRatio: 1,
// //                                   child: product.imageUrls.isNotEmpty
// //                                       ? Image.memory(
// //                                           base64Decode(product.imageUrls.first),
// //                                           fit: BoxFit.cover,
// //                                           errorBuilder:
// //                                               (context, error, stackTrace) {
// //                                             return const Icon(
// //                                                 Icons.image_not_supported);
// //                                           },
// //                                         )
// //                                       : const Icon(Icons.image_not_supported),
// //                                 ),
// //                                 Padding(
// //                                   padding: const EdgeInsets.all(8.0),
// //                                   child: Column(
// //                                     crossAxisAlignment:
// //                                         CrossAxisAlignment.start,
// //                                     children: [
// //                                       const Text(
// //                                         '⭐⭐⭐⭐⭐(5)',
// //                                         style: TextStyle(fontSize: 10),
// //                                       ),
// //                                       Text(
// //                                         product.productName,
// //                                         style: styling(
// //                                             fontFamily: 'Poppins-Bold',
// //                                             fontSize: 20),
// //                                         maxLines: 1,
// //                                         overflow: TextOverflow.ellipsis,
// //                                       ),
// //                                       const SizedBox(height: 4),
// //                                       Text(
// //                                         product.brandName ?? 'Loading...',
// //                                         style: styling(
// //                                             fontFamily: 'Poppins-Regular',
// //                                             fontSize: 12,
// //                                             color: Colors.grey),
// //                                       ),
// //                                       const SizedBox(height: 4),
// //                                       Text(
// //                                         '\₹${product.price.toStringAsFixed(2)}',
// //                                         style: styling(
// //                                             fontFamily: 'Poppins-Regular',
// //                                             fontSize: 12),
// //                                       ),
// //                                     ],
// //                                   ),
// //                                 ),
// //                               ],
// //                             ),
// //                           ),
// //                         );
// //                       },
// //                     ),
// //                   );
// //                 }

// //                 return const SizedBox.shrink();
// //               },
// //             ),
// //           ],
// //         ),
// //       ),
// //     );
// //   }
// // }
// import 'dart:convert';
// import 'package:flutter/material.dart';
// import 'package:flutter_bloc/flutter_bloc.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_bloc.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_event.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_state.dart';
// import 'package:vesture_firebase_user/screens/product_Details.dart';
// import 'package:vesture_firebase_user/widgets/custom_appbar.dart';
// import 'package:vesture_firebase_user/widgets/custom_search.dart';
// import 'package:vesture_firebase_user/widgets/textwidget.dart';

// class ShoppingPage extends StatelessWidget {
//   const ShoppingPage({super.key});

//   @override
//   Widget build(BuildContext context) {
//     return BlocProvider(
//       create: (context) => ProductBloc()..add(FetchProductsEvent()),
//       child: Scaffold(
//         appBar: buildCustomAppBar(context: context, title: 'Shopping Page'),
//         body: Column(
//           children: [
//             customSearchField(context),
//             BlocBuilder<ProductBloc, ProductState>(
//               builder: (context, state) {
//                 if (state is ProductLoadingState) {
//                   return const Center(child: CircularProgressIndicator());
//                 }

//                 if (state is ProductErrorState) {
//                   return Center(
//                     child: Text(
//                       'Error: ${state.errorMessage}',
//                       style: const TextStyle(color: Colors.red),
//                     ),
//                   );
//                 }

//                 if (state is ProductLoadedState) {
//                   return Expanded(
//                     child: GridView.builder(
//                       padding: const EdgeInsets.all(10),
//                       gridDelegate:
//                           const SliverGridDelegateWithFixedCrossAxisCount(
//                         crossAxisCount: 2,
//                         childAspectRatio: 0.65,
//                         crossAxisSpacing: 2,
//                         mainAxisSpacing: 2,
//                       ),
//                       itemCount: state.products.length,
//                       itemBuilder: (context, index) {
//                         final product = state.products[index];
//                         final defaultImages = product.getDefaultImages();
//                         final defaultPrice = product.getDefaultPrice();

//                         return GestureDetector(
//                           onTap: () {
//                             Navigator.push(
//                                 context,
//                                 MaterialPageRoute(
//                                     builder: (context) => ProductDetailsPage(
//                                         productId: product.id!)));
//                           },
//                           child: SizedBox(
//                             child: Card(
//                               shape: RoundedRectangleBorder(
//                                 borderRadius: BorderRadius.circular(1),
//                               ),
//                               elevation: 2,
//                               shadowColor: Colors.red,
//                               child: Column(
//                                 crossAxisAlignment: CrossAxisAlignment.start,
//                                 children: [
//                                   AspectRatio(
//                                     aspectRatio: 1,
//                                     child: defaultImages.isNotEmpty
//                                         ? Image.memory(
//                                             base64Decode(defaultImages.first),
//                                             fit: BoxFit.cover,
//                                             errorBuilder:
//                                                 (context, error, stackTrace) {
//                                               return const Icon(
//                                                   Icons.image_not_supported);
//                                             },
//                                           )
//                                         : const Icon(Icons.image_not_supported),
//                                   ),
//                                   Padding(
//                                     padding: const EdgeInsets.all(8.0),
//                                     child: Column(
//                                       crossAxisAlignment:
//                                           CrossAxisAlignment.start,
//                                       children: [
//                                         const Text(
//                                           '⭐⭐⭐⭐⭐(5)',
//                                           style: TextStyle(fontSize: 10),
//                                         ),
//                                         Text(
//                                           product.productName,
//                                           style: styling(
//                                             fontFamily: 'Poppins-Bold',
//                                             fontSize: 20,
//                                           ),
//                                           maxLines: 1,
//                                           overflow: TextOverflow.ellipsis,
//                                         ),
//                                         const SizedBox(height: 4),
//                                         Text(
//                                           product.brandName ?? 'Loading...',
//                                           style: styling(
//                                             fontFamily: 'Poppins-Regular',
//                                             fontSize: 12,
//                                             color: Colors.grey,
//                                           ),
//                                         ),
//                                         const SizedBox(height: 4),
//                                         Text(
//                                           '\₹${defaultPrice.toStringAsFixed(2)}',
//                                           style: styling(
//                                             fontFamily: 'Poppins-Regular',
//                                             fontSize: 12,
//                                           ),
//                                         ),
//                                       ],
//                                     ),
//                                   ),
//                                 ],
//                               ),
//                             ),
//                           ),
//                         );
//                       },
//                     ),
//                   );
//                 }

//                 return const SizedBox.shrink();
//               },
//             ),
//           ],
//         ),
//       ),
//     );
//   }
// }


// // import 'package:flutter/material.dart';
// // import 'package:flutter_bloc/flutter_bloc.dart';
// // import 'package:vesture_firebase_user/bloc/bloc/categories_bloc.dart';
// // import 'package:vesture_firebase_user/bloc/bloc/categories_event.dart';
// // import 'package:vesture_firebase_user/bloc/bloc/categories_state.dart';
// // import 'package:vesture_firebase_user/models/category_model.dart';
// // import 'package:vesture_firebase_user/screens/categories_shop.dart';
// // import 'package:vesture_firebase_user/screens/shopping_page.dart';
// // import 'package:vesture_firebase_user/widgets/custom_appbar.dart';
// // import 'package:vesture_firebase_user/widgets/custom_button.dart';
// // import 'package:vesture_firebase_user/widgets/custom_search.dart';
// // import 'package:vesture_firebase_user/widgets/textwidget.dart';

// // class ShopCategories extends StatelessWidget {
// //   const ShopCategories({super.key});

// //   @override
// //   Widget build(BuildContext context) {
// //     return BlocProvider(
// //       create: (context) => CategoryBloc()..add(FetchCategoriesEvent()),
// //       child: Scaffold(
// //         appBar: buildCustomAppBar(context: context, title: 'Shopping Page'),
// //         body: Column(
// //           children: [
// //             customSearchField(context, isCategorySearch: true),
// //             Expanded(
// //               child: BlocBuilder<CategoryBloc, CategoryState>(
// //                 builder: (context, categoryState) {
// //                   if (categoryState is CategoryLoadingState) {
// //                     return Center(
// //                       child: customSpinkitLoaderWithType(
// //                         context: context,
// //                         type: SpinkitType.fadingCube,
// //                         color: Colors.red,
// //                         size: 40.0,
// //                       ),
// //                     );
// //                   }

// //                   if (categoryState is CategoryLoadedState ||
// //                       categoryState is CategorySearchState) {
// //                     // Determine the list of categories based on state
// //                     final categories = categoryState is CategoryLoadedState
// //                         ? categoryState.categories
// //                         : (categoryState as CategorySearchState).searchResults;

// //                     return ListView.builder(
// //                       // separatorBuilder: (context, index) => customDivider(),
// //                       padding: const EdgeInsets.all(10.0),
// //                       itemCount: categories.length + 1,
// //                       itemBuilder: (context, index) {
// //                         if (index == 0) {
// //                           return Padding(
// //                               padding: const EdgeInsets.only(bottom: 16.0),
// //                               child: customButton(
// //                                   borderRadius: 50,
// //                                   height: 55,
// //                                   context: context,
// //                                   text: 'View All Products',
// //                                   onPressed: () {
// //                                     Navigator.of(context)
// //                                         .push(MaterialPageRoute(builder: (ctx) {
// //                                       return ShoppingPage();
// //                                     }));
// //                                   }));
// //                         }

// //                         final category = categories[index - 1];
// //                         return ListTile(
// //                           title: Text(
// //                             category.name,
// //                             style: const TextStyle(
// //                               fontFamily: 'Poppins-SemiBold',
// //                               fontSize: 16,
// //                             ),
// //                           ),
// //                           onTap: () {
// //                             Navigator.of(context).push(MaterialPageRoute(
// //                                 builder: (ctx) =>
// //                                     CategoryProductPage(category: category)));
// //                           },
// //                         );
// //                       },
// //                     );
// //                   }

// //                   return const SizedBox.shrink();
// //                 },
// //               ),
// //             ),
// //           ],
// //         ),
// //       ),
// //     );
// //   }
// // // }
// // import 'package:flutter/material.dart';
// // import 'package:flutter_bloc/flutter_bloc.dart';
// // import 'package:vesture_firebase_user/bloc/bloc/categories_bloc.dart';
// // import 'package:vesture_firebase_user/bloc/bloc/categories_event.dart';
// // import 'package:vesture_firebase_user/bloc/bloc/categories_state.dart';
// // import 'package:vesture_firebase_user/models/category_model.dart';
// // import 'package:vesture_firebase_user/screens/shopping_page.dart';
// // import 'package:vesture_firebase_user/screens/categories_shop.dart';
// // import 'package:vesture_firebase_user/widgets/custom_search.dart';
// // import 'package:vesture_firebase_user/widgets/custom_button.dart';

// // class ShopCategories extends StatelessWidget {
// //   const ShopCategories({super.key});

// //   @override
// //   Widget build(BuildContext context) {
// //     return BlocProvider(
// //       create: (context) => CategoryBloc()..add(FetchCategoriesEvent()),
// //       child: Scaffold(
// //         appBar: AppBar(title: const Text('Shopping Page')),
// //         body: Column(
// //           children: [
// //             // Search Field
// //             customSearchField(
// //               context,
// //               isCategorySearch: true,
// //               // onSearch: (query) {
// //               //   context
// //               //       .read<CategoryBloc>()
// //               //       .add(SearchCategoriesEvent(query: query));
// //               // },
// //             ),

// //             // Categories List
// //             Expanded(
// //               child: BlocBuilder<CategoryBloc, CategoryState>(
// //                 builder: (context, categoryState) {
// //                   if (categoryState is CategoryLoadingState) {
// //                     return const Center(
// //                       child: CircularProgressIndicator(),
// //                     );
// //                   }

// //                   if (categoryState is CategoryLoadedState ||
// //                       categoryState is CategorySearchState) {
// //                     final categories = categoryState is CategoryLoadedState
// //                         ? categoryState.categories
// //                         : (categoryState as CategorySearchState).searchResults;

// //                     return ListView.builder(
// //                       padding: const EdgeInsets.all(10.0),
// //                       itemCount: categories.length + 1,
// //                       itemBuilder: (context, index) {
// //                         if (index == 0) {
// //                           return Padding(
// //                             padding: const EdgeInsets.only(bottom: 16.0),
// //                             child: customButton(
// //                               borderRadius: 50,
// //                               height: 55,
// //                               context: context,
// //                               text: 'View All Products',
// //                               onPressed: () {
// //                                 Navigator.of(context).push(
// //                                   MaterialPageRoute(
// //                                     builder: (ctx) => ShoppingPage(),
// //                                   ),
// //                                 );
// //                               },
// //                             ),
// //                           );
// //                         }

// //                         final category = categories[index - 1];
// //                         return ListTile(
// //                           title: Text(
// //                             category.name,
// //                             style: const TextStyle(
// //                               fontSize: 16,
// //                               fontWeight: FontWeight.bold,
// //                             ),
// //                           ),
// //                           onTap: () {
// //                             Navigator.of(context).push(MaterialPageRoute(
// //                               builder: (ctx) => CategoryProductPage(
// //                                 category: category,
// //                               ),
// //                             ));
// //                           },
// //                         );
// //                       },
// //                     );
// //                   }

// //                   if (categoryState is CategorySearchState &&
// //                       categoryState.searchResults.isEmpty) {
// //                     return const Center(
// //                       child: Text(
// //                         'No categories found!',
// //                         style: TextStyle(fontSize: 16),
// //                       ),
// //                     );
// //                   }

// //                   return const SizedBox.shrink();
// //                 },
// //               ),
// //             ),
// //           ],
// //         ),
// //       ),
// //     );
// //   }
// // }
// import 'package:flutter/material.dart';
// import 'package:flutter_bloc/flutter_bloc.dart';
// import 'package:vesture_firebase_user/bloc/bloc/categories_bloc.dart';
// import 'package:vesture_firebase_user/bloc/bloc/categories_event.dart';
// import 'package:vesture_firebase_user/bloc/bloc/categories_state.dart';
// import 'package:vesture_firebase_user/models/category_model.dart';
// import 'package:vesture_firebase_user/screens/shopping_page.dart';
// import 'package:vesture_firebase_user/screens/categories_shop.dart';
// import 'package:vesture_firebase_user/widgets/custom_search.dart';
// import 'package:vesture_firebase_user/widgets/custom_button.dart';

// class ShopCategories extends StatelessWidget {
//   const ShopCategories({super.key});

//   @override
//   Widget build(BuildContext context) {
//     return BlocProvider(
//       create: (context) => CategoryBloc()..add(FetchCategoriesEvent()),
//       child: Scaffold(
//         appBar: AppBar(title: const Text('Shopping Page')),
//         body: Column(
//           children: [
//             // Search Field (uncomment the onSearch callback)
//             customSearchField(
//               context,
//               isCategorySearch: true,
//               // onSearch: (query) {
//               //   context
//               //       .read<CategoryBloc>()
//               //       .add(SearchCategoriesEvent(query: query));
//               // },
//             ),

//             // Categories List
//             Expanded(
//               child: BlocBuilder<CategoryBloc, CategoryState>(
//                 builder: (context, categoryState) {
//                   if (categoryState is CategoryLoadingState) {
//                     return const Center(
//                       child: CircularProgressIndicator(),
//                     );
//                   }

//                   // Modify the condition to handle both loaded and search states
//                   if (categoryState is CategoryLoadedState ||
//                       categoryState is CategorySearchState) {
//                     final categories = categoryState is CategoryLoadedState
//                         ? categoryState.categories
//                         : (categoryState as CategorySearchState).searchResults;

//                     // Handle empty search results
//                     if (categories.isEmpty) {
//                       return const Center(
//                         child: Text(
//                           'No categories found!',
//                           style: TextStyle(fontSize: 16),
//                         ),
//                       );
//                     }

//                     return ListView.builder(
//                       padding: const EdgeInsets.all(10.0),
//                       itemCount: categories.length + 1,
//                       itemBuilder: (context, index) {
//                         if (index == 0) {
//                           return Padding(
//                             padding: const EdgeInsets.only(bottom: 16.0),
//                             child: customButton(
//                               borderRadius: 50,
//                               height: 55,
//                               context: context,
//                               text: 'View All Products',
//                               onPressed: () {
//                                 Navigator.of(context).push(
//                                   MaterialPageRoute(
//                                     builder: (ctx) => ShoppingPage(),
//                                   ),
//                                 );
//                               },
//                             ),
//                           );
//                         }

//                         final category = categories[index - 1];
//                         return ListTile(
//                           title: Text(
//                             category.name,
//                             style: const TextStyle(
//                               fontSize: 16,
//                               fontWeight: FontWeight.bold,
//                             ),
//                           ),
//                           onTap: () {
//                             Navigator.of(context).push(MaterialPageRoute(
//                               builder: (ctx) => CategoryProductPage(
//                                 category: category,
//                               ),
//                             ));
//                           },
//                         );
//                       },
//                     );
//                   }

//                   return const SizedBox.shrink();
//                 },
//               ),
//             ),
//           ],
//         ),
//       ),
//     );
//   }
// }

// import 'package:flutter/material.dart';
// import 'package:flutter_bloc/flutter_bloc.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_bloc.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_event.dart';
// import 'package:vesture_firebase_user/bloc/Product/product_state.dart';
// import 'package:vesture_firebase_user/models/category_model.dart';
// import 'package:vesture_firebase_user/screens/product_Details.dart';
// import 'package:vesture_firebase_user/widgets/custom_appbar.dart';
// import 'package:vesture_firebase_user/widgets/custom_search.dart';
// import 'package:vesture_firebase_user/widgets/sheet_sort.dart';
// import 'package:vesture_firebase_user/widgets/textwidget.dart';
// import 'dart:convert';

// class CategoryProductPage extends StatelessWidget {
//   final CategoryModel category;

//   const CategoryProductPage({super.key, required this.category});

//   @override
//   Widget build(BuildContext context) {
//     return BlocProvider(
//       create: (context) => ProductBloc()
//         ..add(FetchProductsByCategoryEvent(categoryId: category.id!)),
//       child: Scaffold(
//         appBar: buildCustomAppBar(context: context, title: category.name),
//         body: Column(
//           children: [
//             customSearchField(context, category: category),
//             customFilterSortRow(
//               context: context,
//               onFilterPressed: () {
//                 // Add filtering logic here
//               },
//               onSortPressed: () {
//                 // Trigger the bottom sheet for sorting
//                 showSortBottomSheet(
//                   context,
//                   (sortOption) {
//                     // Handle the selected sort option
//                     print('Selected Sort Option: $sortOption');
//                   },
//                 );
//               },
//             ),
//             BlocBuilder<ProductBloc, ProductState>(
//               builder: (context, state) {
//                 if (state is ProductLoadingState) {
//                   return Expanded(
//                     child: Center(
//                         child: customSpinkitLoaderWithType(
//                       context: context,
//                       type: SpinkitType.fadingCube,
//                       color: Colors.red,
//                       size: 60.0,
//                     )),
//                   );
//                 }

//                 if (state is ProductErrorState) {
//                   return Expanded(
//                     child: Center(
//                       child: Text(
//                         'Error: ${state.errorMessage}',
//                         style: const TextStyle(color: Colors.red),
//                       ),
//                     ),
//                   );
//                 }

//                 if (state is ProductLoadedState) {
//                   // If no products in this category
//                   if (state.products.isEmpty) {
//                     return Expanded(
//                       child: Center(
//                         child: Text(
//                           'No products found in ${category.name}',
//                           style: styling(
//                             fontFamily: 'Poppins-Bold',
//                             fontSize: 16,
//                           ),
//                         ),
//                       ),
//                     );
//                   }

//                   return Expanded(
//                     child: GridView.builder(
//                       padding: const EdgeInsets.all(10),
//                       gridDelegate:
//                           const SliverGridDelegateWithFixedCrossAxisCount(
//                         crossAxisCount: 2,
//                         childAspectRatio: 0.65,
//                         crossAxisSpacing: 2,
//                         mainAxisSpacing: 2,
//                       ),
//                       itemCount: state.products.length,
//                       itemBuilder: (context, index) {
//                         final product = state.products[index];
//                         final defaultImages = product.getDefaultImages();
//                         final defaultPrice = product.getDefaultPrice();

//                         return GestureDetector(
//                           onTap: () {
//                             Navigator.push(
//                                 context,
//                                 MaterialPageRoute(
//                                     builder: (context) => ProductDetailsPage(
//                                         productId: product.id!)));
//                           },
//                           child: SizedBox(
//                             child: Card(
//                               shape: RoundedRectangleBorder(
//                                 borderRadius: BorderRadius.circular(1),
//                               ),
//                               elevation: 2,
//                               shadowColor: Colors.red,
//                               child: Column(
//                                 crossAxisAlignment: CrossAxisAlignment.start,
//                                 children: [
//                                   AspectRatio(
//                                     aspectRatio: 1,
//                                     child: defaultImages.isNotEmpty
//                                         ? Image.memory(
//                                             base64Decode(defaultImages.first),
//                                             fit: BoxFit.cover,
//                                             errorBuilder:
//                                                 (context, error, stackTrace) {
//                                               return const Icon(
//                                                   Icons.image_not_supported);
//                                             },
//                                           )
//                                         : const Icon(Icons.image_not_supported),
//                                   ),
//                                   Padding(
//                                     padding: const EdgeInsets.all(8.0),
//                                     child: Column(
//                                       crossAxisAlignment:
//                                           CrossAxisAlignment.start,
//                                       children: [
//                                         const Text(
//                                           '⭐⭐⭐⭐⭐(5)',
//                                           style: TextStyle(fontSize: 10),
//                                         ),
//                                         Text(
//                                           product.productName,
//                                           style: styling(
//                                             fontFamily: 'Poppins-Bold',
//                                             fontSize: 20,
//                                           ),
//                                           maxLines: 1,
//                                           overflow: TextOverflow.ellipsis,
//                                         ),
//                                         const SizedBox(height: 4),
//                                         Text(
//                                           product.brandName ?? 'Unknown Brand',
//                                           style: styling(
//                                             fontFamily: 'Poppins-Regular',
//                                             fontSize: 12,
//                                             color: Colors.grey,
//                                           ),
//                                         ),
//                                         const SizedBox(height: 4),
//                                         Text(
//                                           '\₹${defaultPrice.toStringAsFixed(2)}',
//                                           style: styling(
//                                             fontFamily: 'Poppins-Regular',
//                                             fontSize: 12,
//                                           ),
//                                         ),
//                                       ],
//                                     ),
//                                   ),
//                                 ],
//                               ),
//                             ),
//                           ),
//                         );
//                       },
//                     ),
//                   );
//                 }

//                 return const SizedBox.shrink();
//               },
//             ),
//           ],
//         ),
//       ),
//     );
//   }
// }